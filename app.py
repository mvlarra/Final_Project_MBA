# Este ser√° el archivo principal de navegaci√≥n de tu app Streamlit. 
# Render lo usar√° como punto de inicio.
# ¬øQu√© debe contener ese archivo?
    # Como ya trabajaste todos los pasos dentro del notebook market_basket_analysis_VL.ipynb, 
    # lo ideal es que vayamos trasladando las partes clave al archivo .py, empezando 
    # por la secci√≥n Summary Report que quer√©s mostrar primero.

# Puedo ayudarte a construirlo, secci√≥n por secci√≥n, con:
    # Encabezado
    # Sidebar (si quer√©s navegaci√≥n)
    # Visualizaci√≥n del Summary Report (top support, bundles, heatmap, etc.)
    # Visualizaci√≥n en modo Streamlit compatible con Render



# Tu archivo app.py ahora tiene:
#     Una barra lateral de navegaci√≥n con 4 secciones
#     Visualizaci√≥n del Summary Report completo
#     Soporte para Render.com
#     Carga de datasets externos desde data/processed/
# üìå Record√° crear o guardar estos archivos si a√∫n no existen:
#     summary_rules.csv
#     bundle_products.csv
#     tabular_bundle.csv


import os
port = os.environ.get("PORT", 8501)
import ast  # Para convertir el string a lista real si es necesario
from utils.loader import load_data  
from utils.visual_helpers import ( 
    mostrar_top_10_productos,
    mostrar_transacciones_por_mes,
    mostrar_ejemplo_canasta
)
import pandas as pd
import numpy as np
import plotly.express as px
import plotly.graph_objects as go
import networkx as nx
import streamlit as st
from PIL import Image
from charts.HeatmapXTab import HeatmapCrosstab, draw_heatmap
from charts.GraphNetwork import draw_graph
from utils.show_explanation import show_explanation


# ‚óØ Configuraci√≥n de p√°gina
st.set_page_config(page_title="Market Basket Analysis", layout="wide")

# Ajustar el tama√±o de letra base en toda la app
st.markdown("""
    <style>
    html, body, [class*="css"]  {
        font-size: 14px !important;
    }
    </style>
""", unsafe_allow_html=True)


# ‚óØ Mostrar imagen en el sidebar
logo = Image.open("app/images/Img_0.png")
st.sidebar.image(logo, use_container_width=True)

# # ‚óØ Texto centrado debajo de la imagen
# st.sidebar.markdown(
#     """
#     <div style="
#         text-align: center;
#         font-size: 30px;
#         font-family:  'Poppins', 'Quicksand', sans-serif;
#         font-weight: 600;
#         margin-top: 10px;
#     ">
#         üõçÔ∏è MBA
#     </div>

#     <hr style="margin-top: 10px; margin-bottom: 20px; border: none; border-top: 1px solid #88888833;" />
#     """,
#     unsafe_allow_html=True
# )

# ‚óØ Cargar datasets procesados (desde utils/loader.py)

dataset_sample, Top_10_Mas_Vendidos, example_basket, monthly_transactions, rules, df_bundle_products, tabular, Top_5_Rules_by_Score = load_data()

# ‚óØ Sidebar para navegaci√≥n
# ............................................................................................

st.sidebar.title("üß≠ Navegaci√≥n")
section = st.sidebar.radio("Ir a la secci√≥n:", (
    "1. üìò Acerca del Proyecto",
    "2. üìã Resumen del Proyecto",
    "3. üß™ Metodolog√≠a del An√°lisis",
    "4. üìä Exploraci√≥n de Datos",
    "5. üîé Explorar Reglas de Asociaci√≥n",
    "6. üõí Recomendaciones y Estrategias por Producto",
    "7. üíº Acciones estrat√©gicas para tu negocio",   
    "8. üìè Glosario de M√©tricas", 
    "OLD 1. üè† Inicio",
    "OLD 9. üìé Cr√©ditos y recursos del proyecto",
    # "üß™ Methodology",
    # "üìè Key Metrics",
    # "üîÅ Cross Selling Products",
    # "OLD 4.1 ‚öôÔ∏è Reglas de Asociaci√≥n",
    # "OLD 7. üó∫Ô∏è Visualizaci√≥n de Relaciones",
    # "OLD 5. üì¶ Bundles de Productos",
    # "OLD 6. üõçÔ∏è Recomendaciones para tu carrito",
    # "Heatmap del Bundle",
    # "üìå Heatmap de Producto"
))



# 1. ‚óØ New Secci√≥n: ACERCAS DEL PROYECTO (Unificar Secci√≥n 1 (Resumen) y Secci√≥n 9 (Cr√©ditos))
# ............................................................................................
# Objetivo:
#   Presentar el prop√≥sito general del proyecto, su contexto, el objetivo del an√°lisis y los cr√©ditos.
# Contenido:
#   - Objetivo del an√°lisis
#   - Tecnolog√≠as utilizadas
#   - Recursos y v√≠nculos
#   - Contacto profesional

if section.startswith("1."):
    from sections.section_1_about import show_section_1_about
    show_section_1_about()

# 2. ‚óØ Secci√≥n: RESUMEN DEL PROYECTO
# ............................................................................................
# Objetivo:
#   Presentar un resumen ejecutivo del an√°lisis realizado, destacando el prop√≥sito del proyecto, el origen de los datos,
#   la metodolog√≠a aplicada y los principales hallazgos obtenidos.
# Contenido:
#   - Objetivo del an√°lisis y foco comercial
#   - Fuente y caracter√≠sticas del dataset utilizado
#   - Metodolog√≠a empleada (Apriori, m√©tricas de asociaci√≥n)
#   - Hallazgos destacados y ejemplos de reglas obtenidas
#   - Recomendaciones accionables para el negocio
#   - Tecnolog√≠as y herramientas utilizadas en el desarrollo

elif section.startswith("2."):
    from sections.section_2_summary import show_section_2_summary
    show_section_2_summary()

# ‚óØ Secci√≥n 3: METODOLOGIA DE ANALISIS
# -----------------------------------------------------------------------------------------------------------------
# Objetivo:
#   Describir el origen del dataset, el enfoque metodol√≥gico y los par√°metros utilizados para generar las reglas de asociaci√≥n.
# Contenido:
#   - Fuente del dataset y contexto comercial
#   - Algoritmo utilizado (Apriori)
#   - Biblioteca empleada (mlxtend)
#   - Par√°metros clave del modelo: combinaci√≥n m√°xima y soporte m√≠nimo

elif section.startswith("3."):
    from sections.section_3_methodology import show_section_3_methodology
    show_section_3_methodology()




# ‚óØ Secci√≥n 4: EXPLORACI√ìN DE DATOS
# ............................................................................................
# Objetivo:
#   Realizar una primera aproximaci√≥n visual al dataset para comprender su estructura y contenido.
# Contenido:
#   - Vista general del dataset original
#   - Productos m√°s vendidos
#   - Ejemplo real de una transacci√≥n
#   - Distribuci√≥n mensual de transacciones

elif section.startswith("4."):
    from sections.section_4_data_exploration import show_section_4
    show_section_4(dataset_sample, Top_10_Mas_Vendidos, example_basket, monthly_transactions)

    
# ‚óØ Seccion 5: EXPLORAR REGLAS DE ASOCIACI√ìN (unificada)
# ............................................................................................
# Objetivo:
#   Permitir al usuario explorar de manera interactiva las reglas de asociaci√≥n generadas mediante Apriori.
# Contenido:
#   - Reglas destacadas con mayor score
#   - Red de relaciones entre productos
#   - Heatmap cruzado entre productos
#   - Tabla completa de todas las reglas generadas

elif section.startswith("5. üîé"):
    from sections.section_5_rules import show_section_5_rules
    show_section_5_rules(rules, tabular, Top_5_Rules_by_Score)



# ‚óØ Seccion 6: RECOMENDACIONES Y ESTRATEGIAS POR PRODUCTO
# ............................................................................................
# Objetivo:
#   Ofrecer recomendaciones y estrategias accionables basadas en productos reales.
# Contenido:
#   - Reglas destacadas por soporte y score
#   - Bundles de productos descubiertos
#   - Recomendaciones personalizadas por producto
#   - Heatmap cruzado por producto
#   - Identificaci√≥n de oportunidades de cross-selling

elif section.startswith("6. üõí"):
    from sections.section_6_recommendations import show_section_6_recommendations 
    show_section_6_recommendations(rules, df_bundle_products, Top_5_Rules_by_Score)
    
# 7. ‚óØ Secci√≥n: ACCIONES ESTRAT√âGICAS PARA TU NEGOCIO
# ............................................................................................
# Objetivo:
#   Traducir hallazgos anal√≠ticos en acciones pr√°cticas que generen impacto comercial.
# Contenido:
#   - Sugerencias accionables como bundles, descuentos o reubicaciones
#   - Asociaci√≥n entre reglas y productos clave
#   - Priorizaci√≥n personalizada de acciones por parte del usuario
#   - Exportaci√≥n de las acciones seleccionadas

elif section.startswith("7."):
    from sections.section_7_actions import show_section_7_actions
    show_section_7_actions(rules, Top_10_Mas_Vendidos)



# ‚óØ Secci√≥n 8: GOLOSARIO DE METRICAS
# -----------------------------------------------------------------------------------------------------------------
# Objetivo:
#   Proporcionar definiciones claras y f√≥rmulas clave de las m√©tricas utilizadas en el an√°lisis de reglas de asociaci√≥n.
# Contenido:
#   - Definiciones de Support, Confidence, Lift, Leverage y Conviction
#   - Ejemplos de f√≥rmulas aplicadas
#   - Explicaciones orientadas a usuarios de negocio no t√©cnicos

elif section == "8. üìè Glosario de M√©tricas":
   import sections.section_8_glosario
